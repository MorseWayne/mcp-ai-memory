---
name: project-memory-sync
description: 自动同步项目知识到长期记忆系统。当用户询问项目功能/设计（使用"熟悉"、"了解"、"本项目"等词汇），或修改了代码、接口、文档时，自动使用 MCP 记忆服务添加、更新或删除相关记忆。
---

# 项目记忆同步

本 Skill 让 Cursor Agent 自动管理项目知识的长期记忆，与 `mem0-local` MCP 服务配合使用。

## 触发条件

### 场景 A：用户询问项目信息

检测以下关键词或意图：
- "熟悉"、"了解"、"介绍"
- "本项目"、"这个项目"、"当前项目"
- "功能"、"设计"、"架构"、"实现"
- "怎么工作"、"如何实现"、"是什么"

**动作**：先搜索记忆获取已有知识，结合代码分析回答用户。

### 场景 B：代码/文档变更

检测以下行为：
- 修改了核心代码文件（非测试/配置）
- 新增/删除/重命名接口或函数
- 修改了 README、DESIGN、SPEC 等文档
- 变更了 API 定义、Proto、Schema

**动作**：将变更内容同步到记忆系统。

## 操作流程

### 1. 查询项目信息时

```
步骤 1: 搜索已有记忆
→ 调用 search_memories(query="项目[功能/设计/架构]相关内容")

步骤 2: 分析代码库
→ 阅读相关源码，理解当前实现

步骤 3: 整合回答
→ 结合记忆 + 代码分析，回答用户问题

步骤 4: 补充记忆（如发现新知识）
→ 调用 add_memory 保存新发现的重要信息
```

### 2. 修改代码/文档后

```
步骤 1: 分析变更内容
→ 识别：新增功能 / 修改功能 / 删除功能

步骤 2: 搜索相关记忆
→ 调用 search_memories 查找可能需要更新的记忆

步骤 3: 选择操作

如果是【新增功能】：
  → add_memory(text="[项目名] 新增了 [功能描述]")

如果是【修改功能】：
  → 找到相关记忆 ID
  → update_memory(memory_id="xxx", text="[更新后的描述]")

如果是【删除功能】：
  → 找到相关记忆 ID
  → delete_memory(memory_id="xxx")

步骤 4: 确认同步
→ 告知用户记忆已更新
```

## MCP 工具使用指南

### 添加记忆

```json
// 保存新功能/新知识
{
  "tool": "add_memory",
  "server": "mem0-local",
  "arguments": {
    "text": "[项目名] [功能模块]: [具体描述]",
    "metadata": {
      "type": "project_knowledge",
      "project": "项目名称",
      "category": "feature|design|api|config"
    }
  }
}
```

**记忆文本格式建议**：
- `[项目名] 核心功能: ...`
- `[项目名] API接口: ...`
- `[项目名] 设计决策: ...`
- `[项目名] 配置说明: ...`

### 搜索记忆

```json
// 查找相关记忆
{
  "tool": "search_memories",
  "server": "mem0-local",
  "arguments": {
    "query": "项目名 关键词",
    "limit": 10
  }
}
```

### 更新记忆

```json
// 修改已有记忆
{
  "tool": "update_memory",
  "server": "mem0-local",
  "arguments": {
    "memory_id": "从搜索结果获取",
    "text": "更新后的完整描述"
  }
}
```

### 删除记忆

```json
// 删除过时记忆
{
  "tool": "delete_memory",
  "server": "mem0-local",
  "arguments": {
    "memory_id": "从搜索结果获取"
  }
}
```

## 判断策略

### 何时添加记忆

- 新增了重要功能或模块
- 发现了项目的关键设计决策
- 用户明确要求记住某些信息
- 修复了重要 bug（记录问题和解决方案）

### 何时更新记忆

- 功能行为发生变化
- API 签名/参数修改
- 配置项变更
- 设计方案调整

### 何时删除记忆

- 功能被完全移除
- 记忆内容已过时且不再适用
- 用户明确要求删除

### 何时不操作

- 仅格式化代码、修复 typo
- 添加注释、调整空格
- 测试文件的变更
- 临时性的调试代码

## 记忆内容规范

### 有效的记忆示例

```
✅ "mcp-ai-memory 项目使用 Mem0 库实现长期记忆存储，支持 Qdrant 和 pgvector 向量库"
✅ "mcp-ai-memory 的 add_memory 接口支持 text、messages、user_id、metadata 等参数"
✅ "项目支持 SSE 和 stdio 两种传输模式，通过 TRANSPORT 环境变量切换"
```

### 无效的记忆示例

```
❌ "修改了代码"（太模糊）
❌ "添加了一些功能"（没有具体内容）
❌ "文件在 src/server.py"（仅位置信息，无实质内容）
```

## 注意事项

1. **避免重复**：添加前先搜索，避免重复记忆
2. **保持简洁**：每条记忆聚焦一个知识点
3. **包含上下文**：记忆中包含项目名，便于后续检索
4. **及时更新**：代码变更后主动更新相关记忆
5. **用户确认**：重要操作前可询问用户确认
